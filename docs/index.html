<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>JS Lottery</title>
        <style>
            html,
            body {
              margin: 0;
              padding: 0;
            }

            body {
              display: -webkit-flex;
              display: -moz-flex;
              display: -ms-flex;
              display: -o-flex;
              display: flex;

              width: 100%;

              flex-direction: column;

              font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;
              letter-spacing: 0;
              font-weight: 400;
              font-style: normal;
              text-rendering: optimizeLegibility;
              -webkit-font-smoothing: antialiased;
            }
            
            .box_group {
              position: relative;

              display: -webkit-flex;
              display: -moz-flex;
              display: -ms-flex;
              display: -o-flex;
              display: flex;
              flex-wrap: wrap;
              margin: auto;
              margin-top: 50px;
              width: 100%;
            }

            .boxs {
              position: relative;
              flex: 0 0 33.33%;
              height: auto;
              -webkit-background-size: cover;
              background-size: cover;
              background-repeat: no-repeat;
            }

            .boxs.addcover:before {
              position: absolute;
              content: '';
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background-color: rgba(0, 0, 0, .5);
            }

            .boxs.a {
              background-color: #ffdde5;
              background-image: url(http://www.gratisography.com/pictures/361_1.jpg);
            }
            .boxs.b {
              background-color: #ddbbbb;
              background-image: url(http://www.gratisography.com/pictures/360_1.jpg);
            }
            .boxs.c {
              background-color: #ffddff;
              background-image: url(http://www.gratisography.com/pictures/338_1.jpg);
            }
            .boxs.d {
              background-color: #cce5ee;
              background-image: url(http://www.gratisography.com/pictures/342_1.jpg);
            }
            .boxs.e {
              background-color: #bbd4dd;
              background-image: url(http://www.gratisography.com/pictures/347_1.jpg);
            }
            .boxs.f {
              background-color: #bbddbb;
              background-image: url(http://www.gratisography.com/pictures/350_1.jpg);
            }
            .boxs.g {
              background-color: #eee5cc;
              background-image: url(http://www.gratisography.com/pictures/357_1.jpg);
            }
            .boxs.h {
              background-color: #bcd4d0;
              background-image: url(http://www.gratisography.com/pictures/340_1.jpg);
            }
            .boxs.i {
              background-color: #999999;
              background-image: url(http://www.gratisography.com/pictures/332_1.jpg);
            }

            .start, 
            .cancel {
              margin: auto;
              margin-top: 20px;
              width: 150px;
              height: 45px;
              line-height: 45px;
              text-align: center;
              font-size: 14px;
              border-radius: 3px;
              cursor: pointer;
            }

            .start {
              background-color: #333333;
              color: #ffffff;
            }
            
            .cancel {
              border: 1px solid #333333;
              color: #333333;
            }

        </style>
    </head>
    <body>
      <div class="box_group">
        <div class="boxs addcover a"></div>
        <div class="boxs addcover b"></div>
        <div class="boxs addcover c"></div>
        <div class="boxs addcover d"></div>
        <div class="boxs addcover e"></div>
        <div class="boxs addcover f"></div>
        <div class="boxs addcover g"></div>
        <div class="boxs addcover h"></div>
        <div class="boxs addcover i"></div>
      </div>
      <div class="start">Start</div>
      <div class="cancel">Cancel</div>
    </body>
    <script>

    // class Lottery {
    //     constructor(option){
    //         this._boxs = option['boxs'];

    //         this._stop = false;
    //         this._num = 0;
    //         this._defaultWidth = null;
    //         this._defaultHeight = null;
    //     }

    //     getBoxs(){
    //         return Lottery.getElements(this._boxs);
    //     }

    // }

    // Lottery.getElements = function(els){
    //     let _elements,
    //         _el,
    //         _len,
    //         _j,
    //         _ref;

    //     _elements = [];

    //     _ref = document.querySelectorAll(els);

    //     for (_j = 0, _len = _ref.length; _j < _len; _j++) {
    //         _el = _ref[_j];
    //         _elements.push(_el);
    //     }

    //     return _elements;
    // }

    // const boxLottery = new Lottery({
    //     'boxs': '.boxs',
    // });

    // console.log('boxLottery ==> ', boxLottery);
    // console.log('boxLottery_getBoxs ==> ', boxLottery.getBoxs());

    function shuffle(arr) {
        let i,
            j,
            temp;
        for (i = arr.length - 1; i > 0; i--) {
            j = Math.floor(Math.random() * (i + 1));
            temp = arr[i];
            arr[i] = arr[j];
            arr[j] = temp;
        }
        return arr;
    };

    ((w, d) => {

        let _boxs = d.querySelectorAll('.boxs'),
            _num = 0,
            _stop = false,
            _touch = true,
            _defaultWidth = null,
            _defaultHeight = null;

        function toggleSilder(){
            shuffle([].slice.call(_boxs)).forEach((e, i) => {
                setTimeout(() => {

                    _num++;
                  
                    if (_num > 8) {
                        _num = 0;
                        if (_stop === true) {
                            changeBig(e);
                            return;
                        }

                        toggleSilder();

                    } else {

                        resetAllStatus();
                        e.classList.remove('addcover');

                    }
              
                }, getTime(i) );
            })
        }

        function resizeItem(){
            _boxs.forEach((e, i) => {
                e.style.height = e.clientWidth + 'px';
            })
        }

        function resetAllStatus() {
            _boxs.forEach((e, i) => {
                if (!e.classList.contains('addcover')) {
                    e.classList.add('addcover');
                }
            });
        }
        
        function changeBig(r){
            let w = r.parentNode.clientWidth;
            let h = r.parentNode.clientWidth;

            r.style.position = 'absolute';
            r.style.top = 0;
            r.style.left = 0;
            r.style.zIndex = 11111;

            r.style.width = w + "px";
            r.style.height = h + "px";

            r.classList.remove('addcover');
        }

        function getTime(s){
            return s * 200 * 0.8;
        }

        d.querySelector('.start').addEventListener('click', () => {

            if (_touch === true) {
                _stop = false;
                _touch = false;

                _boxs.forEach((e, i) => {
                    e.style.position = '';
                    e.style.zIndex = '';
                    e.style.width = _defaultWidth + "px";
                    e.style.height = _defaultHeight+ "px";
                })

                toggleSilder();
            }
        });

        d.querySelector('.cancel').addEventListener('click', () => {
            _stop = true;
            _touch = true;
        });

        w.addEventListener('resize', (event) => {
            _boxs.forEach((e, i) => {
                e.style.height = e.clientWidth + 'px';
                _defaultWidth = e.clientWidth;
                _defaultHeight = e.clientHeight;
            })
        });
        
        resizeItem();

    })(window, document);


    </script>
</html>